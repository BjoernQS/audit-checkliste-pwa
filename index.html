<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audit Checkliste ‚Äì Q-Pr√ºfer Lengsfeld</title>

  <!-- PWA Meta & Manifest -->
  <meta name="theme-color" content="#003366">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
    }
    /* Platzhalter ‚Äì vollst√§ndiges CSS im Original einf√ºgen */
  </style>
</head>
<body>
  <div id="audit-content">
    <header>
      <h1>Audit Checkliste ‚Äì Q-Pr√ºfer Lengsfeld</h1>
      <div class="date-stamp" id="dateStamp"></div>
    </header>

    <div class="button-container">
      <button onclick="generatePDF()">üìÑ PDF erstellen</button>
    </div>

    <div id="auditBody"></div>

    <div class="summary">
      <h2>Auswertung</h2>
      <p><strong>Gesamtpunktzahl:</strong> <span id="score">0</span></p>
      <p><strong>Anzahl 0 (Rot):</strong> <span id="count0">0</span></p>
      <p><strong>Anzahl 1 (Gelb):</strong> <span id="count1">0</span></p>
      <p><strong>Anzahl 2 (Gr√ºn):</strong> <span id="count2">0</span></p>
    </div>
  </div>

  <script>
    const fragen = [
      ["Dokumentation", "Sind die Arbeitsanweisungen vollst√§ndig, aktuell, verst√§ndlich und an der Linie verf√ºgbar?"],
      ["Prozess√ºberwachung", "Werden Maschinenparameter gem√§√ü Freigabe-/Bemusterungsunterlagen festgelegt, freigegeben und dokumentiert?"],
      ["Prozess√ºberwachung", "Werden relevante Prozessparameter systematisch √ºberwacht und ausgewertet?"]
    ];

    function buildTable() {
      const auditBody = document.getElementById("auditBody");
      const table = document.createElement("table");
      table.innerHTML = `
        <thead>
          <tr>
            <th>Kategorie</th>
            <th>Frage</th>
            <th>Bewertung</th>
            <th>Kommentar</th>
          </tr>
        </thead>
        <tbody>
          ${fragen.map(f => `
            <tr>
              <td>${f[0]}</td>
              <td>${f[1]}</td>
              <td>
                <select>
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select>
              </td>
              <td><div contenteditable="true" style="min-height:80px; border:1px solid #ccc;"></div></td>
            </tr>
          `).join("")}
        </tbody>
      `;
      auditBody.appendChild(table);

      document.querySelectorAll("select").forEach(sel =>
        sel.addEventListener("change", updateScore)
      );
    }

    function updateScore() {
      const selects = document.querySelectorAll("select");
      let sum = 0, c0 = 0, c1 = 0, c2 = 0;
      selects.forEach(s => {
        const val = +s.value;
        sum += val;
        if (val === 0) c0++;
        else if (val === 1) c1++;
        else if (val === 2) c2++;
      });
      document.getElementById("score").textContent = sum;
      document.getElementById("count0").textContent = c0;
      document.getElementById("count1").textContent = c1;
      document.getElementById("count2").textContent = c2;
    }

    function generatePDF() {
      const now = new Date();
      const formattedDate = now.toLocaleDateString('de-DE');
      document.getElementById("dateStamp").textContent = `Erstellt am: ${formattedDate}`;

      const element = document.getElementById('audit-content');
      const opt = {
        margin: 0.5,
        filename: 'Audit_Q-Checkliste.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'cm', format: 'a4', orientation: 'landscape' }
      };
      html2pdf().set(opt).from(element).save();
    }

    buildTable();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('‚úÖ Service Worker registriert:', reg.scope))
          .catch(err => console.error('‚ö†Ô∏è Fehler beim Registrieren:', err));
      });
    }
  </script>
</body>
</html>
